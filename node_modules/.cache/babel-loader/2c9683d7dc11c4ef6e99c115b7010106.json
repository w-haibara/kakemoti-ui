{"ast":null,"code":"import { createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeStyle as _normalizeStyle, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-3f0ba34b\"), n = n(), _popScopeId(), n);\n\nconst _hoisted_1 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h3\", null, \"Drawflow Example vue3\", -1\n/* HOISTED */\n));\n\nconst _hoisted_2 = /*#__PURE__*/_createTextVNode(\"Export\");\n\nconst _hoisted_3 = [\"data-node\"];\n\nconst _hoisted_4 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", null, \"Data:\", -1\n/* HOISTED */\n));\n\nconst _hoisted_5 = {\n  class: \"dialog-footer\"\n};\n\nconst _hoisted_6 = /*#__PURE__*/_createTextVNode(\"Cancel\");\n\nconst _hoisted_7 = /*#__PURE__*/_createTextVNode(\"Confirm\");\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n\n  const _component_el_header = _resolveComponent(\"el-header\");\n\n  const _component_el_aside = _resolveComponent(\"el-aside\");\n\n  const _component_el_main = _resolveComponent(\"el-main\");\n\n  const _component_el_container = _resolveComponent(\"el-container\");\n\n  const _component_el_dialog = _resolveComponent(\"el-dialog\");\n\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createVNode(_component_el_container, null, {\n    default: _withCtx(() => [_createVNode(_component_el_header, {\n      class: \"header\"\n    }, {\n      default: _withCtx(() => [_hoisted_1, _createVNode(_component_el_button, {\n        type: \"primary\",\n        onClick: $setup.exportEditor\n      }, {\n        default: _withCtx(() => [_hoisted_2]),\n        _: 1\n        /* STABLE */\n\n      }, 8\n      /* PROPS */\n      , [\"onClick\"])]),\n      _: 1\n      /* STABLE */\n\n    }), _createVNode(_component_el_container, {\n      class: \"container\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_aside, {\n        width: \"250px\",\n        class: \"column\"\n      }, {\n        default: _withCtx(() => [_createElementVNode(\"ul\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.listNodes, n => {\n          return _openBlock(), _createElementBlock(\"li\", {\n            key: n,\n            draggable: \"true\",\n            \"data-node\": n.item,\n            onDragstart: _cache[0] || (_cache[0] = $event => $setup.drag($event)),\n            class: \"drag-drawflow\"\n          }, [_createElementVNode(\"div\", {\n            class: \"node\",\n            style: _normalizeStyle(`background: ${n.color}`)\n          }, _toDisplayString(n.name), 5\n          /* TEXT, STYLE */\n          )], 40\n          /* PROPS, HYDRATE_EVENTS */\n          , _hoisted_3);\n        }), 128\n        /* KEYED_FRAGMENT */\n        ))])]),\n        _: 1\n        /* STABLE */\n\n      }), _createVNode(_component_el_main, null, {\n        default: _withCtx(() => [_createElementVNode(\"div\", {\n          id: \"drawflow\",\n          onDrop: _cache[1] || (_cache[1] = $event => $setup.drop($event)),\n          onDragover: _cache[2] || (_cache[2] = $event => $setup.allowDrop($event))\n        }, null, 32\n        /* HYDRATE_EVENTS */\n        )]),\n        _: 1\n        /* STABLE */\n\n      })]),\n      _: 1\n      /* STABLE */\n\n    })]),\n    _: 1\n    /* STABLE */\n\n  }), _createVNode(_component_el_dialog, {\n    modelValue: $setup.dialogVisible,\n    \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => $setup.dialogVisible = $event),\n    title: \"Export\",\n    width: \"50%\"\n  }, {\n    footer: _withCtx(() => [_createElementVNode(\"span\", _hoisted_5, [_createVNode(_component_el_button, {\n      onClick: _cache[3] || (_cache[3] = $event => $setup.dialogVisible = false)\n    }, {\n      default: _withCtx(() => [_hoisted_6]),\n      _: 1\n      /* STABLE */\n\n    }), _createVNode(_component_el_button, {\n      type: \"primary\",\n      onClick: _cache[4] || (_cache[4] = $event => $setup.dialogVisible = false)\n    }, {\n      default: _withCtx(() => [_hoisted_7]),\n      _: 1\n      /* STABLE */\n\n    })])]),\n    default: _withCtx(() => [_hoisted_4, _createElementVNode(\"pre\", null, [_createElementVNode(\"code\", null, _toDisplayString($setup.dialogData), 1\n    /* TEXT */\n    )])]),\n    _: 1\n    /* STABLE */\n\n  }, 8\n  /* PROPS */\n  , [\"modelValue\"])], 64\n  /* STABLE_FRAGMENT */\n  );\n}","map":{"version":3,"mappings":";;;;gEAGMA,oBAA8B,IAA9B,EAA8B,IAA9B,EAAI,uBAAJ,EAAyB;AAAA;AAAzB;;iDACgD;;;;gEA6BlDA,oBAAkB,MAAlB,EAAkB,IAAlB,EAAM,OAAN,EAAW;AAAA;AAAX;;;EAGQC,KAAK,EAAC;;;iDACgC;;iDAEvC;;;;;;;;;;;;;;;6DAtCTC,aA8BeC,uBA9Bf,EA8Be,IA9Bf,EA8Be;sBA7Bb,MAGY,CAHZD,aAGYE,oBAHZ,EAGY;MAHDH,KAAK,EAAC;IAGL,CAHZ,EAAyB;wBACvB,MAA8B,CAA9BI,UAA8B,EAC9BH,aAAkEI,oBAAlE,EAAkE;QAAvDC,IAAI,EAAC,SAAkD;QAAvCC,OAAK,EAAEC;MAAgC,CAAlE;0BAAgD,MAAM;;;;OAAtD;;MAAA,cAD8B,EADP;;;;IAAA,CAAzB,CAGY,EACZP,aAwBeC,uBAxBf,EAwBe;MAxBDF,KAAK,EAAC;IAwBL,CAxBf,EAA+B;wBAC7B,MAeW,CAfXC,aAeWQ,mBAfX,EAeW;QAfDC,KAAK,EAAC,OAeL;QAfaV,KAAK,EAAC;MAenB,CAfX;0BACE,MAaK,CAbLD,oBAaK,IAbL,EAaK,IAbL,EAaK,oBAZHY,oBAWKC,SAXL,EAWK,IAXL,EAWKC,YAVSL,gBAUT,EAVIM,CAAc,IAAb;+BADVH,oBAWK,IAXL,EAWK;YATFI,GAAG,EAAED,CASH;YARHE,SAAS,EAAC,MAQP;YAPF,aAAWF,CAAC,CAACG,IAOX;YANFC,WAAS,sCAAEV,YAAKW,MAAL,CAAF,CAMP;YALHnB,KAAK,EAAC;UAKH,CAXL,GAQED,oBAEM,KAFN,EAEM;YAFDC,KAAK,EAAC,MAEL;YAFaoB,KAAK,iCAAiBN,CAAC,CAACO,KAAK,EAAxB;UAElB,CAFN,mBACKP,CAAC,CAACQ,KADP,EACW;UAAA;UADX,EARF;;UAAA;SAWK,CAXL;;QAAA,CAYG,EAbL,CAaK;;;;OAdP,CAeW,EACXrB,aAMUsB,kBANV,EAMU,IANV,EAMU;0BALR,MAIO,CAJPxB,oBAIO,KAJP,EAIO;UAHLyB,EAAE,EAAC,UAGE;UAFJC,MAAI,sCAAEjB,YAAKW,MAAL,CAAF,CAEA;UADJO,UAAQ,sCAAElB,iBAAUW,MAAV,CAAF;QACJ,CAJP;;QAAA,CAIO,EACC;;;;MAAA,CANV,CADW,EAhBkB;;;;IAAA,CAA/B,CADY,EA0BC;;;;EAAA,CA9Bf,GA+BAlB,aAWY0B,oBAXZ,EAWY;gBAXQnB,oBAWR;+DAXQA,uBAAaW,OAWrB;IAXuBS,KAAK,EAAC,QAW7B;IAXsClB,KAAK,EAAC;EAW5C,CAXZ;IAGamB,MAAM,WACf,MAKO,CALP9B,oBAKO,MALP,cAKO,CAJLE,aAA4DI,oBAA5D,EAA4D;MAAhDE,OAAK,sCAAEC,uBAAa,KAAf;IAA2C,CAA5D;wBAA0C,MAAM;;;;KAAhD,CAIK,EAHLP,aAECI,oBAFD,EAEC;MAFUC,IAAI,EAAC,SAEf;MAF0BC,OAAK,sCAAEC,uBAAa,KAAf;IAE/B,CAFD;wBACG,MAAO;;;;KADV,CAGK,CALP,CAKO,CANQ;sBAFjB,MAAkB,CAAlBsB,UAAkB,EAClB/B,oBAAsC,KAAtC,EAAsC,IAAtC,EAAsC,CAAjCA,oBAA2B,MAA3B,EAA2B,IAA3B,EAA2BgC,iBAAnBvB,iBAAmB,CAA3B,EAAkB;IAAA;IAAlB,CAAiC,CAAtC,CADkB;;;;GADpB;;EAAA","names":["_createElementVNode","class","_createVNode","_component_el_container","_component_el_header","_hoisted_1","_component_el_button","type","onClick","$setup","_component_el_aside","width","_createElementBlock","_Fragment","_renderList","n","key","draggable","item","onDragstart","$event","style","color","name","_component_el_main","id","onDrop","onDragover","_component_el_dialog","title","footer","_hoisted_4","_toDisplayString"],"sourceRoot":"","sources":["/home/haibara/ghq/github.com/w-haibara/kakemoti-ui/src/components/drawflowComponent.vue"],"sourcesContent":["<template>\n  <el-container>\n    <el-header class=\"header\">\n      <h3>Drawflow Example vue3</h3>\n      <el-button type=\"primary\" @click=\"exportEditor\">Export</el-button>\n    </el-header>\n    <el-container class=\"container\">\n      <el-aside width=\"250px\" class=\"column\">\n        <ul>\n          <li\n            v-for=\"n in listNodes\"\n            :key=\"n\"\n            draggable=\"true\"\n            :data-node=\"n.item\"\n            @dragstart=\"drag($event)\"\n            class=\"drag-drawflow\"\n          >\n            <div class=\"node\" :style=\"`background: ${n.color}`\">\n              {{ n.name }}\n            </div>\n          </li>\n        </ul>\n      </el-aside>\n      <el-main>\n        <div\n          id=\"drawflow\"\n          @drop=\"drop($event)\"\n          @dragover=\"allowDrop($event)\"\n        ></div>\n      </el-main>\n    </el-container>\n  </el-container>\n  <el-dialog v-model=\"dialogVisible\" title=\"Export\" width=\"50%\">\n    <span>Data:</span>\n    <pre><code>{{dialogData}}</code></pre>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"dialogVisible = false\">Cancel</el-button>\n        <el-button type=\"primary\" @click=\"dialogVisible = false\"\n          >Confirm</el-button\n        >\n      </span>\n    </template>\n  </el-dialog>\n</template>\n<script>\nimport Drawflow from \"drawflow\";\nimport \"drawflow/dist/drawflow.min.css\";\nimport \"@/assets/style.css\";\nimport {\n  onMounted,\n  shallowRef,\n  h,\n  getCurrentInstance,\n  render,\n  readonly,\n  ref,\n} from \"vue\";\nimport NodeOne from \"./nodes/nodeOne.vue\";\nimport NodeTwo from \"./nodes/nodeTwo.vue\";\nimport NodeThree from \"./nodes/nodeThree.vue\";\n\nimport startNode from \"./nodes/startNode.vue\";\n\nexport default {\n  name: \"drawflowComponent\",\n  setup() {\n    const listNodes = readonly([\n      {\n        name: \"Get/Post\",\n        color: \"#49494970\",\n        item: \"startNode\",\n        input: 0,\n        output: 1,\n      },\n    ]);\n\n    const editor = shallowRef({});\n    const dialogVisible = ref(false);\n    const dialogData = ref({});\n    const Vue = { version: 3, h, render };\n    const internalInstance = getCurrentInstance();\n    internalInstance.appContext.app._context.config.globalProperties.$df =\n      editor;\n\n    function exportEditor() {\n      dialogData.value = editor.value.export();\n      dialogVisible.value = true;\n    }\n\n    const drag = (ev) => {\n      if (ev.type === \"touchstart\") {\n        mobile_item_selec = ev.target\n          .closest(\".drag-drawflow\")\n          .getAttribute(\"data-node\");\n      } else {\n        ev.dataTransfer.setData(\"node\", ev.target.getAttribute(\"data-node\"));\n      }\n    };\n    const drop = (ev) => {\n      if (ev.type === \"touchend\") {\n        var parentdrawflow = document\n          .elementFromPoint(\n            mobile_last_move.touches[0].clientX,\n            mobile_last_move.touches[0].clientY\n          )\n          .closest(\"#drawflow\");\n        if (parentdrawflow != null) {\n          addNodeToDrawFlow(\n            mobile_item_selec,\n            mobile_last_move.touches[0].clientX,\n            mobile_last_move.touches[0].clientY\n          );\n        }\n        mobile_item_selec = \"\";\n      } else {\n        ev.preventDefault();\n        var data = ev.dataTransfer.getData(\"node\");\n        addNodeToDrawFlow(data, ev.clientX, ev.clientY);\n      }\n    };\n    const allowDrop = (ev) => {\n      ev.preventDefault();\n    };\n\n    let mobile_item_selec = \"\";\n    let mobile_last_move = null;\n    function positionMobile(ev) {\n      mobile_last_move = ev;\n    }\n\n    function addNodeToDrawFlow(name, pos_x, pos_y) {\n      pos_x =\n        pos_x *\n          (editor.value.precanvas.clientWidth /\n            (editor.value.precanvas.clientWidth * editor.value.zoom)) -\n        editor.value.precanvas.getBoundingClientRect().x *\n          (editor.value.precanvas.clientWidth /\n            (editor.value.precanvas.clientWidth * editor.value.zoom));\n      pos_y =\n        pos_y *\n          (editor.value.precanvas.clientHeight /\n            (editor.value.precanvas.clientHeight * editor.value.zoom)) -\n        editor.value.precanvas.getBoundingClientRect().y *\n          (editor.value.precanvas.clientHeight /\n            (editor.value.precanvas.clientHeight * editor.value.zoom));\n\n      const nodeSelected = listNodes.find((ele) => ele.item == name);\n      editor.value.addNode(\n        name,\n        nodeSelected.input,\n        nodeSelected.output,\n        pos_x,\n        pos_y,\n        name,\n        {},\n        name,\n        \"vue\"\n      );\n    }\n\n    onMounted(() => {\n      var elements = document.getElementsByClassName(\"drag-drawflow\");\n      for (var i = 0; i < elements.length; i++) {\n        elements[i].addEventListener(\"touchend\", drop, false);\n        elements[i].addEventListener(\"touchmove\", positionMobile, false);\n        elements[i].addEventListener(\"touchstart\", drag, false);\n      }\n\n      const id = document.getElementById(\"drawflow\");\n      editor.value = new Drawflow(\n        id,\n        Vue,\n        internalInstance.appContext.app._context\n      );\n      editor.value.start();\n\n      editor.value.registerNode(\"NodeOne\", NodeOne, {}, {});\n      editor.value.registerNode(\"NodeTwo\", NodeTwo, {}, {});\n      editor.value.registerNode(\"NodeThree\", NodeThree, {}, {});\n\n      editor.value.import({\n        drawflow: {\n          Home: {\n            data: {\n              5: {\n                id: 5,\n                name: \"NodeTwo\",\n                data: { script: \"(req,res) => {\\n console.log(req);\\n}\" },\n                class: \"NodeTwo\",\n                html: \"NodeTwo\",\n                typenode: \"vue\",\n                inputs: {\n                  input_1: { connections: [{ node: \"6\", input: \"output_1\" }] },\n                },\n                outputs: {\n                  output_1: { connections: [] },\n                  output_2: { connections: [] },\n                },\n                pos_x: 1000,\n                pos_y: 117,\n              },\n              6: {\n                id: 6,\n                name: \"NodeOne\",\n                data: { url: \"localhost/add\", method: \"post\" },\n                class: \"NodeOne\",\n                html: \"NodeOne\",\n                typenode: \"vue\",\n                inputs: {},\n                outputs: {\n                  output_1: { connections: [{ node: \"5\", output: \"input_1\" }] },\n                },\n                pos_x: 137,\n                pos_y: 89,\n              },\n            },\n          },\n        },\n      });\n    });\n\n    return {\n      exportEditor,\n      listNodes,\n      drag,\n      drop,\n      allowDrop,\n      dialogVisible,\n      dialogData,\n    };\n  },\n};\n</script>\n<style scoped>\n.header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border-bottom: 1px solid #494949;\n}\n.container {\n  min-height: calc(100vh - 100px);\n}\n.column {\n  border-right: 1px solid #494949;\n}\n.column ul {\n  padding-inline-start: 0px;\n  padding: 10px 10px;\n}\n.column li {\n  background: transparent;\n}\n\n.node {\n  border-radius: 8px;\n  border: 2px solid #494949;\n  display: block;\n  height: 60px;\n  line-height: 40px;\n  padding: 10px;\n  margin: 10px 0px;\n  cursor: move;\n}\n#drawflow {\n  width: 100%;\n  height: 100%;\n  text-align: initial;\n  background: #2b2c30;\n  background-size: 20px 20px;\n  background-image: radial-gradient(#494949 1px, transparent 1px);\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}