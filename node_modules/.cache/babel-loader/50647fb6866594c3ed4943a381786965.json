{"ast":null,"code":"import { nextTick } from 'vue';\nimport { on, off } from 'element-plus/es/utils/dom';\nimport { obtainAllFocusableElements, EVENT_CODE } from 'element-plus/es/utils/aria';\nexport const FOCUSABLE_CHILDREN = '_trap-focus-children';\nexport const TRAP_FOCUS_HANDLER = '_trap-focus-handler';\nconst FOCUS_STACK = [];\n\nconst FOCUS_HANDLER = e => {\n  var _a;\n\n  if (FOCUS_STACK.length === 0) return;\n  const focusableElement = FOCUS_STACK[FOCUS_STACK.length - 1][FOCUSABLE_CHILDREN];\n\n  if (focusableElement.length > 0 && e.code === EVENT_CODE.tab) {\n    if (focusableElement.length === 1) {\n      e.preventDefault();\n\n      if (document.activeElement !== focusableElement[0]) {\n        focusableElement[0].focus();\n      }\n\n      return;\n    }\n\n    const goingBackward = e.shiftKey;\n    const isFirst = e.target === focusableElement[0];\n    const isLast = e.target === focusableElement[focusableElement.length - 1];\n\n    if (isFirst && goingBackward) {\n      e.preventDefault();\n      focusableElement[focusableElement.length - 1].focus();\n    }\n\n    if (isLast && !goingBackward) {\n      e.preventDefault();\n      focusableElement[0].focus();\n    }\n\n    if (process.env.NODE_ENV === 'test') {\n      const index = focusableElement.findIndex(element => element === e.target);\n\n      if (index !== -1) {\n        (_a = focusableElement[goingBackward ? index - 1 : index + 1]) === null || _a === void 0 ? void 0 : _a.focus();\n      }\n    }\n  }\n};\n\nconst TrapFocus = {\n  beforeMount(el) {\n    el[FOCUSABLE_CHILDREN] = obtainAllFocusableElements(el);\n    FOCUS_STACK.push(el);\n\n    if (FOCUS_STACK.length <= 1) {\n      on(document, 'keydown', FOCUS_HANDLER);\n    }\n  },\n\n  updated(el) {\n    nextTick(() => {\n      el[FOCUSABLE_CHILDREN] = obtainAllFocusableElements(el);\n    });\n  },\n\n  unmounted() {\n    FOCUS_STACK.shift();\n\n    if (FOCUS_STACK.length === 0) {\n      off(document, 'keydown', FOCUS_HANDLER);\n    }\n  }\n\n};\nexport default TrapFocus;","map":{"version":3,"names":["nextTick","on","off","obtainAllFocusableElements","EVENT_CODE","FOCUSABLE_CHILDREN","TRAP_FOCUS_HANDLER","FOCUS_STACK","FOCUS_HANDLER","e","_a","length","focusableElement","code","tab","preventDefault","document","activeElement","focus","goingBackward","shiftKey","isFirst","target","isLast","process","env","NODE_ENV","index","findIndex","element","TrapFocus","beforeMount","el","push","updated","unmounted","shift"],"sources":["/home/haibara/ghq/github.com/w-haibara/kakemoti-ui/node_modules/element-plus/es/directives/trap-focus/index.js"],"sourcesContent":["import { nextTick } from 'vue';\nimport { on, off } from 'element-plus/es/utils/dom';\nimport { obtainAllFocusableElements, EVENT_CODE, } from 'element-plus/es/utils/aria';\nexport const FOCUSABLE_CHILDREN = '_trap-focus-children';\nexport const TRAP_FOCUS_HANDLER = '_trap-focus-handler';\nconst FOCUS_STACK = [];\nconst FOCUS_HANDLER = (e) => {\n    var _a;\n    if (FOCUS_STACK.length === 0)\n        return;\n    const focusableElement = FOCUS_STACK[FOCUS_STACK.length - 1][FOCUSABLE_CHILDREN];\n    if (focusableElement.length > 0 && e.code === EVENT_CODE.tab) {\n        if (focusableElement.length === 1) {\n            e.preventDefault();\n            if (document.activeElement !== focusableElement[0]) {\n                focusableElement[0].focus();\n            }\n            return;\n        }\n        const goingBackward = e.shiftKey;\n        const isFirst = e.target === focusableElement[0];\n        const isLast = e.target === focusableElement[focusableElement.length - 1];\n        if (isFirst && goingBackward) {\n            e.preventDefault();\n            focusableElement[focusableElement.length - 1].focus();\n        }\n        if (isLast && !goingBackward) {\n            e.preventDefault();\n            focusableElement[0].focus();\n        }\n        if (process.env.NODE_ENV === 'test') {\n            const index = focusableElement.findIndex((element) => element === e.target);\n            if (index !== -1) {\n                (_a = focusableElement[goingBackward ? index - 1 : index + 1]) === null || _a === void 0 ? void 0 : _a.focus();\n            }\n        }\n    }\n};\nconst TrapFocus = {\n    beforeMount(el) {\n        el[FOCUSABLE_CHILDREN] = obtainAllFocusableElements(el);\n        FOCUS_STACK.push(el);\n        if (FOCUS_STACK.length <= 1) {\n            on(document, 'keydown', FOCUS_HANDLER);\n        }\n    },\n    updated(el) {\n        nextTick(() => {\n            el[FOCUSABLE_CHILDREN] = obtainAllFocusableElements(el);\n        });\n    },\n    unmounted() {\n        FOCUS_STACK.shift();\n        if (FOCUS_STACK.length === 0) {\n            off(document, 'keydown', FOCUS_HANDLER);\n        }\n    },\n};\nexport default TrapFocus;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}